# -*- coding: utf-8 -*-
"""Clustering com DBSCAN.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1mLliFvKlMF_H7r7x0Saogx4Sv6T7Mano

# **Clustering de empresas de crédito ativo**

O objetivo do projeto é explorar uma base de dados relacionada a créditos ativos de clientes com o intuito de identificar padrões, perfils e possíveis insights financeiros a partir dessas informações disponíveis.

# Clustering com DBSCAN

O DBSCAN é um algoritmo baseado em densidade utilizado para identificar grupos de dados com alta densidade. Seus componentes principais são:


1.   Parametro do algoritmo:




*   eps: Raio máximo para definir a vizinhança de um ponto.
*   min samples:Número mínimo de pontos necessários (incluindo o ponto central) para que uma região seja considerada densa.



2.   Tipo de pontos



*   Pontos centrais: Um ponto com pelo menos min_samples (vizinhos) em sua vizinhança (eps)
*   Pontos de borda: Pontos que estão na vizinhança mas não são densos o suficiente para serem pontos centrais são marcados como um ponto central.
*   Ruidos: Pontos que não pertencem a nenhum cluster.



**3.   Inicialização:**


*   Começa com um ponto não visitado e verifica sua vizinhança dentro do raio eps.
*   Se tem um ponto tem pelo menosvizinhos ele é marcado como um ponto central e um novo cluster é iniciado.


*   Todos os pontos em suas vizinhanças são adcionadosao cluster, e esse processo é repetido recursivamente para todos os vizinhos centrais até que todos os pontos conectados densamente sejam identificados.
"""

import pandas as pd
import duckdb
import numpy as np
from scipy import stats
import matplotlib.pyplot as plt
import seaborn as sns
import statsmodels.api as sm
from sklearn.preprocessing import StandardScaler, OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, make_scorer
from sklearn.linear_model import LogisticRegression
import joblib
from sklearn.impute import SimpleImputer
from sklearn.model_selection import KFold, cross_val_score
from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay, classification_report
from sklearn.cluster import DBSCAN
from sklearn.decomposition import PCA

# Caminho do arquivo (ajustar conforme necessário)
file_path = '/content/creditos-ativos-estados-municipios (version 1).xlsx'

# Verifique se o arquivo existe antes de carregá-lo
import os

if os.path.exists(file_path):
    excel_data = pd.ExcelFile(file_path)
    print(excel_data.sheet_names)
    df = excel_data.parse('creditos-ativos-estados-municip')
    print(df.head())
else:
    print(f"Arquivo {file_path} não encontrado.")

display(df)

"""**Dicionário da base**

**mes_referencia:** Representa o mês e o ano de referência da base de dados no formato YYYYMM.


**tipo_ente:** Descrição: Tipo de ente público relacionado à operação de crédito.


**cnpj_ente_principal:** Número do CNPJ do ente principal responsável pelo crédito.


**uf_ente_principal:** Unidade Federativa (UF) onde o ente principal está localizado.


**tipo_vinculo**: Relação do ente com a operação de crédito, podendo ser principal ou secundária.


**qtde_entes**: Quantidade de entes envolvidos na operação de crédito.


**situacao_debito**: Situação atual do débito.


**tributo**: Tipo de tributo relacionado à operação de crédito.

**vlr_principal**: Valor principal do débito em reais (R$).

**vlr_multa** : Valor da multa associada ao débito em reais (R$).

**vlr_juros**: Valor dos juros incidentes sobre o débito em reais (R$).

**vlr_total**: Soma do valor principal, multa e juros, representando o valor total do débito em reais (R$).

# O projeto

**1. Segmentar municípios e estados:**

• Criar agrupamentos que refletem características semelhantes, considerando variáveis financeiras como valores de débito principal, multas, juros e totais.

• Avaliar diferenças entre grupos de entes públicos em relação às suas situações de débito e tributos.

**2. Identificar perfis financeiros:**

• Detectar municípios ou estados com comportamentos financeiros discrepantes ou fora do padrão (outliers), como altos valores de débito ou concentração em categorias específicas de tributos.

**3. Analisar oportunidades de atuação:**

• Auxiliar na identificação de clusters que possam indicar regiões prioritárias para ações de gestão financeira, renegociação de dívidas ou intervenções administrativas.

**4. Demonstrar a eficácia de técnicas de clustering:**

• Comparar a aplicação do DBSCAN com abordagens estatísticas tradicionais, destacando como métodos baseados em densidade podem ser úteis para entender bases de dados com poucos atributos e limitações temporais.



**Contexto e Justificativa**



A base de dados apresenta informações limitadas ao ano de 2024 e possui um número reduzido de variáveis. Isso torna desafiador aplicar análises exploratórias tradicionais para identificar padrões mais profundos. O uso do DBSCAN é justificado porque:


• Permite identificar agrupamentos naturais sem a necessidade de especificar o número de clusters previamente.

• Detecta pontos de ruído e outliers, o que é relevante em contextos financeiros para identificar possíveis exceções que demandam atenção especial.

# Criando novas features com a engenharia de features

# Criando proporções financeiras:

Essas variáveis podem ajudar a entender a composição dos valores financeiros

**percentual_multa** = vlr_multa / vlr_total: Percentual de multa em relação ao total.

**percentual_juros** = vlr_juros / vlr_total: Percentual de juros em relação ao total.

**percentual_principal** = vlr_principal / vlr_total: Percentual do valor principal no total.
"""

# Proporções financeiras
df['percentual_multa'] = df['vlr_multa'] / df['vlr_total']
df['percentual_juros'] = df['vlr_juros'] / df['vlr_total']
df['percentual_principal'] = df['vlr_principal'] / df['vlr_total']

"""# Criando a variável de risco financeiro:

Vamos primeiro explorar a distribuição da variável vlr_total que usaremos para criar uma feature de risco financeiro.

Para determinarmos as faixas para a criação de um score estatístico devemos antes explorar sua distribuição na base.

**. Explorar a Distribuição**

**Por quê?**

Entender como os valores estão distribuídos ajuda a identificar:


*   Padrões gerais: concentração em faixas específicas.
*   Outliers: valores muito altos ou baixos que podem distorcer a análise.
*   Assimetria: se os valores estão uniformemente distribuídos ou concentrados em uma extremidade (ex.: cauda longa).
* Identificar pontos de corte para categorizar ou segmentar os dados.


**2. Calcular Estatísticas Descritivas**

**Por quê?**


* As medidas descritivas fornecem uma visão resumida da centralidade (média, mediana) e dispersão (desvio padrão, IQR).
* Percentis ajudam a definir faixas ou limites, como categorias de risco ou de desempenho.


**Benefícios:**

Facilita a criação de limites objetivos, como "alto risco" ou "baixa dívida".

Permite justificar decisões baseadas em dados para dividir os valores em grupos estatisticamente significativos.
"""

sns.histplot(df['vlr_total'], kde=True, bins=30, color='red')
plt.title('Distribuição do Valor Total (vlr_total)')
plt.xlabel('Valor Total (vlr_total)')
plt.ylabel('Frequência')
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()

sns.boxplot(x=df['vlr_total'])
plt.title('Boxplot do Valor Total (vlr_total)')
plt.show()

"""# Assimetria (Right-Skewed)

**O que seria?**

A distribuição é inclinada para o lado direito, ou seja, tem uma cauda longa no lado positivo.
A maioria dos valores está concentrada em valores baixos, mas alguns valores extremos (outliers) puxam a distribuição para a direita.
, assim podemos ver que amaior parte dos dados está concentrada em valores extremos, enquanto os valores baixos são muito menos frequentes indicando uma distribuição desbalanceada.

**Por que a assimetria é importante nesse caso**

**Impacto nos Modelos:**

Modelos baseados em variância, como PCA, ou distâncias, como DBSCAN, podem ser distorcidos pela assimetria.
Valores altos (outliers) contribuem mais para a variância, desviando o foco dos padrões gerais.

**Verificando a distribuição do DF no Geral**

•	Calculando o coeficiente de assimetria (right skewed) para todas as variáveis numéricas:
"""

skewness = df.skew(numeric_only=True)
print(skewness)

"""![image.png](data:image/png;base64,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)

Podemos notar que várias variaveis do nosso DF são em sua maioria, assimetricas à direita pois os coeficientes > 0.
"""

print(df.describe())

"""Vemos também em uma das variaveis que possui assimetria à direita que a qtde_entes, vlr_principal, vlr_multa, vlr_juros, vlr_total: São variáveis numéricas, possivelmente com outliers extremos, como mostra o valor máximo bem maior que o percentil 75.

Percentuais (percentual_multa, percentual_juros, percentual_principal):
Essas variáveis têm valores entre 0 e 1, o que indica que já estão escalonadas e provavelmente não têm outliers significativos.

**Matriz de Correlação**
"""

# Selecionar variáveis para análise de correlação
features = ['vlr_principal', 'vlr_multa', 'vlr_juros', 'vlr_total',
            'percentual_multa', 'percentual_juros', 'percentual_principal']

# Criar a matriz de correlação
correlation_matrix = df[features].corr()

# Exibir a matriz de correlação com um heatmap
plt.figure(figsize=(10, 8))
sns.heatmap(correlation_matrix, annot=True, fmt=".2f", cmap="coolwarm")
plt.title("Matriz de Correlação")
plt.show()

"""##**Correlação Altamente Positiva:**

vlr_principal, vlr_juros, e vlr_total:
Correlação forte (>0.85>0.85), indicando que essas variáveis são altamente redundantes.

Isso ocorre porque o vlr_total parece ser uma soma direta ou quase direta de vlr_principal, vlr_juros, e possivelmente outros componentes.

##**Impacto da Correlação no DBSCAN**

**Redundância:**

Variáveis altamente correlacionadas como vlr_principal, vlr_juros, e vlr_total podem inflar artificialmente as distâncias entre os pontos, dificultando a formação de clusters.

**Distorção de Resultados:**

Variáveis correlacionadas podem sobrecarregar o cálculo de densidade, dando mais peso a informações repetitivas.

**Aumento da Dimensionalidade Efetiva:**

Mesmo com poucas variáveis, a redundância cria um "efeito de alta dimensionalidade", onde os pontos tendem a parecer mais distantes do que realmente estão, prejudicando a formação de clusters.

# Impacto da Correlação no DBSCAN

**Redundância:**

*  Variáveis altamente correlacionadas como vlr_principal, vlr_juros, e vlr_total podem inflar artificialmente as distâncias entre os pontos, dificultando a formação de clusters.


**Distorção de Resultados:**

Variáveis correlacionadas podem sobrecarregar o cálculo de densidade, dando

*  Variáveis correlacionadas podem sobrecarregar o cálculo de densidade, dando mais peso a informações repetitivas.

**Aumento da Dimensionalidade Efetiva:**

Mesmo com poucas variáveis, a redundância cria um “efeito de alta dimensionalidade”, onde os pontos tendem a parecer mais distantes do que realmente estão, prejudicando a formação de clusters.

# Criando uma variavél de Score de Crédito

# **Classificação com Regressão Logística**
Para construir a base necessária ao cálculo do score de crédito, utilizamos um modelo de regressão logística para classificar os clientes (entes) em duas categorias principais:

Em Dia: Clientes que estão com seus compromissos financeiros regularizados.

Inadimplente: Clientes que possuem pendências financeiras ativas.


A regressão logística foi escolhida devido à sua capacidade de estimar probabilidades para cada classe, o que nos permite não apenas realizar classificações binárias, mas também obter um grau de confiança associado a cada previsão.
"""

# Normalizar os nomes das colunas para evitar espaços ou caracteres estranhos
df.columns = df.columns.str.lower().str.replace(' ', '_')

# Pré-processamento
# Tratar valores ausentes
df.fillna(0, inplace=True)

# Transformar `situacao_debito` em uma variável binária
    #1 = PARCELADO (em dia), 0 = DEVEDOR (inadimplente)
df['situacao_debito_bin'] = df['situacao_debito'].apply(lambda x: 1 if x == 'PARCELADO' else 0)

# Criar novas colunas de análise
  #Realizando uma engenharia de features como fizemos acima
  #percentual_multa= vlr_multa / vlr_total: Percentual de multa em relação ao total.
  #percentual_juros = vlr_juros / vlr_total: Percentual de juros em relação ao total.
  #percentual_principal = vlr_principal / vlr_total: Percentual do valor principal no total.

df['percentual_multa'] = (df['vlr_multa'] / df['vlr_total']).fillna(0)
df['percentual_juros'] = (df['vlr_juros'] / df['vlr_total']).fillna(0)
df['percentual_principal'] = df['vlr_principal'] / df['vlr_total'].fillna(0)

# Separar variáveis independentes e target (binária)

X = df[['uf_ente_principal', 'tipo_ente', 'vlr_principal', 'percentual_multa', 'percentual_juros','percentual_principal']]
y = df['situacao_debito_bin']

# Configurar Pré-processamento
    #Definir quais colunas são categóricas e quais são numéricas
categorical_features = ['uf_ente_principal', 'tipo_ente']
numerical_features = ['vlr_principal', 'percentual_multa', 'percentual_juros', 'percentual_principal']

### Processamento ##
  # Usar ColumnTransformer para combinar transformações numéricas e categóricas
preprocessor = ColumnTransformer( #O ColumnTransformer é usado para aplicar transformações específicas em diferentes tipos de colunas
    transformers=[
        ('num', Pipeline([
            ('imputer', SimpleImputer(strategy='mean')),  # Substituir Null pela média
            ('scaler', StandardScaler()) # Aplicar StandardScaler nas colunas numéricas para padronizá-la (z-score)
        ]), numerical_features),  #Aplicar OneHotEncoder nas colunas categóricas para transformá-las em formato numérico
        ('cat', OneHotEncoder(handle_unknown='ignore'), categorical_features)
    ]
)
# preprocessor = ColumnTransformer(
#     transformers=[
#         ('num', StandardScaler(), numerical_features), # Aplicar StandardScaler nas colunas numéricas para padronizá-la
#         ('cat', OneHotEncoder(handle_unknown='ignore'), categorical_features) # Aplicar OneHotEncoder nas colunas categóricas para transformá-las em formato numérico
#     ]
# )

#  Criar o Pipeline usando a sklearn.pipeline import Pipeline
     #O pipeline combina o pré-processamento e o modelo em um fluxo único
model_pipeline = Pipeline(steps=[ # 1 passo: pré-processar os dados
    ('preprocessor', preprocessor), # 2 passo: aplicar o modelo de Regressão Logística
    ('classifier', LogisticRegression(random_state=42, max_iter=1000))
])

#Divisão e Avaliação com K-Fold
kf = KFold(n_splits=5, shuffle=True, random_state=42)
scorer = make_scorer(accuracy_score)

# Avaliação com validação cruzada
scores = cross_val_score(model_pipeline, X, y, cv=kf, scoring=scorer)
print(f"Acurácia Média: {np.mean(scores):.4f}")
print(f"Desvio Padrão das Acurácias: {np.std(scores):.4f}")

# Treinar o Modelo Final
model_pipeline.fit(X, y)

#Exportar o Pipeline
    #Salvar o pipeline treinado
joblib.dump(model_pipeline, 'pipeline_creditos_binario.pkl')

"""# Treinamento do Modelo:

O modelo foi treinado utilizando as variáveis financeiras da base de dados, como:

Valores principais de débitos (vlr_principal),

Proporção de multas e juros em relação ao valor total (percentual_multa e percentual_juros),

Informações categóricas (como o tipo do ente e a UF).


Essas variáveis foram pré-processadas com técnicas como normalização e codificação para garantir um formato adequado ao modelo.


**Previsão Binária:**

A regressão logística usa uma combinação linear das variáveis preditoras e as transforma em uma probabilidade por meio da função sigmoide:

![Captura de tela 2025-01-13 212746.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUwAAABSCAYAAAA/xe0AAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAA7uSURBVHhe7Z0JsFVzHMf/Zd8lZFeWkF0Tsu/ZehRGpuxL1tFIKGv2hIixVWOGQY1lrBlbZQtFlBAho5QiWWNCx/n83vnXeffd+97/3rfcxfczc+be+z/nnnPePe9+72/7/06LKMYJIYSol5bJoxBCiHqQYAohRCASTCGECESCKYQQgUgwhRAiEAmmEEIEIsEUQohAJJhCCBGIBFMIIQKRYAohRCASTCGECESCKYQQgUgwhRAiEAmmEEIEIsEUQohAJJhCCBGIBFMIIQKRYAohRCASTCHKFO4u8/rrr7u99trLffzxx8moaEp0Tx8hyogFCxa4MWPGuPHjx7tXX33VzZgxw6200krupZdecjvttFOylWgqZGEKUUb89ttv7r333nOtW7d2N998s1t//fWTNaI5kIUpRJny/fffuwMOOMDNnz9fFmYzIQtTCCECkWAKIUQgEkwhhAhEgimEEIFIMIUQIhAJphBCBCLBFEKIQCSYQggRiARTCCECkWAKIUQgFSWYX3/9tTviiCPc5MmTkxFRynCdunXr5r777rtkRNTHv//+63744QebFknjDeaW//33327OnDk2Nm/ePHstmoaizSXnor799tvu559/Tkays/rqq9sc2bXWWisZyc7MmTPd8ccf7y699FJ31FFHJaNh/Pnnn+6tt95yn3zyiYnu5ptv7nr37u1WXHHFZAvRVDzzzDNu0KBBbtSoUW7jjTdORkUu/PzxWbNmJSM1UeeipqVogvnLL7+4M844w/r48U+wePFit9xyy7k2bdokW1Qzd+5cE9euXbu622+/vdZ6QPBOPvlk165dO+vg0qJFi2RNGPxi9+rVy73//vt2LPoLPv74426VVVZJthCFgPVz9dVXu3/++ccNHTo0Ga0J/36XXXaZmzZtmnv00Uf1mYvSBsEsJgsWLIj22WefaLXVVotGjBiRjC5l4cKF0SWXXGLrq6qqot9//z1Zs5SRI0dGW221VfTVV18lI4Uxfvz4qFWrVtFhhx2W9TiifiZOnBgNGTIkiq39aI011rDrdtZZZyVrs8N14/oNHz48GRGiNCl6DBML8ptvvnHL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)

Onde
𝑧
z é a soma ponderada das variáveis preditoras.


Com base nessa probabilidade, o modelo classifica o cliente:


Classe 1 (Em Dia): Quando
𝑃
(
Em Dia
)
>
0.5
P(Em Dia)>0.5.


Classe 0 (Inadimplente): Quando
𝑃
(
Em Dia
)
≤
0.5
P(Em Dia)≤0.5.


Probabilidade como Base do Score:

Além da classificação binária, utilizamos a probabilidade gerada pelo modelo para medir a confiança de que um cliente pertence à classe "Em Dia".

Essa probabilidade é posteriormente escalada para um intervalo de 0 a 1000, formando a base do score de crédito.
"""

# Prever os valores do conjunto de dados
y_pred = model_pipeline.predict(X)

# Gerar a matriz de confusão
conf_matrix = confusion_matrix(y, y_pred)

# Exibir a matriz de confusão de forma visual
disp = ConfusionMatrixDisplay(confusion_matrix=conf_matrix, display_labels=['Inadimplente (0)', 'Em Dia (1)'])
disp.plot(cmap='spring')

"""# Interpretação dos Valores

Verdadeiro Negativo (TN): 115,747



*   O modelo previu corretamente que 115,747 clientes estavam Inadimplentes e realmente estavam.



Falso Positivo (FP): 8,379


*   O modelo classificou 8,379 clientes como Em Dia, mas eles estavam na verdade Inadimplentes.
*   Isso pode indicar que o modelo está sendo um pouco "otimista" em prever que clientes estão em dia.



Falso Negativo (FN): 12,694


*   O modelo classificou 12,694 clientes como Inadimplentes, mas eles estavam Em Dia.
*  Esses erros podem ser críticos, especialmente se "Em Dia" for uma classe importante para o seu negócio (por exemplo, para priorizar ações).


Verdadeiro Positivo (TP): 60,000


*   O modelo previu corretamente que 60,000 clientes estavam Em Dia e realmente estavam.

# Criando o Score de Crédito
 Construir um score de crédito que possa ser integrado à base de dados como uma nova feature, enriquecendo-a para análises futuras. Esse score será calculado com base no modelo de classificação desenvolvido, que avalia a probabilidade de um ente estar em dia com suas obrigações financeiras.

 **Definição do Score:**

O score será calculado a partir da probabilidade do modelo de classificação (regressão logística) prever que um ente está "Em Dia" (classe 1).

A probabilidade será escalada para um intervalo de 0 a 1000, representando o grau de confiança do modelo:



*   Score próximo a 1000: Alta probabilidade de estar em dia.
*   Score próximo a 0: Alta probabilidade de estar inadimplente.


**Propósito do Score**:

Representar o risco de crédito de forma escalável e interpretável.
Integrar esse score à base de dados como uma nova coluna, facilitando sua utilização em etapas posteriores.

Para construir um score de 0 a 1000 baseado nessa classificação, podemos usar a probabilidade prevista pelo modelo (saída de predict_proba) como base e escalá-la para o intervalo desejado. Essa abordagem permite que o score represente a confiança do modelo de que um ente está "Em Dia" (classe 1).

# Como Obter as Probabilidades:

*  O método predict_proba retorna a probabilidade de cada classe para cada observação.

*  Vamos usar a probabilidade associada à classe "Em Dia" (1). Item da lista


Escalar as Probabilidades para o Intervalo [0, 1000]:


*   Multiplicar a probabilidade pela escala máxima (1000).

Gerar o Score:

Para cada observação, o score será:

![Captura de tela 2025-01-13 212500.png](data:image/png;base64,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)
"""

# Obter as probabilidades previstas pelo modelo
probabilidades = model_pipeline.predict_proba(X)

# Selecionar a probabilidade da classe 1 (Em Dia)
prob_classe_1 = probabilidades[:, 1]

# Escalar para o intervalo de 0 a 1000
score = (prob_classe_1 * 1000).astype(int)

# Criar uma cópia do DataFrame original antes de adicionar a coluna
# df_resultado = df.copy()

# Adicionar o score ao DataFrame original
df['score'] = score

# Exibir algumas observações para verificar
print(df[['situacao_debito', 'situacao_debito_bin', 'score']].head())

display(df)

"""# Como a Probabilidade é Calculada?

A regressão logística calcula a probabilidade com base na combinação linear das variáveis preditoras
𝑋
X e a aplicação de uma função sigmoide:

Passos:
Cálculo da Combinação Linear:

O modelo calcula uma soma ponderada das variáveis
𝑋
X com os coeficientes
𝑤
w:![Captura de tela 2025-01-13 212711.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaEAAAAzCAYAAAA+cbc+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAABALSURBVHhe7ZwHkFNVF8cvir1g712xgKIjih0LCjaUURzbih2xKyCW0VEsKKMidlGxoDMqNnTEOqJYULH3LjbsooIo1vvd3+Hd/d5mEzabTfKy8v/NZHZz8/Je7nnn3lOTNj7ghBBCiAyYI/krhBBCVB0ZISGEEJkhIySEECIzZISEEEJkhoyQEEKIzJAREkIIkRkyQkIIITJDRkgIIURmyAgJIYTIDBkhIYQQmSEjJIQQIjNkhIQQQmSGjJAQQojMkBESQgiRGTJCQgghMkNGSAghRGbICAkhhMgMGSEhhBCZISMkhBAiM2SEhBBCZIaMkBBCiMyQERJCCJEZMkJCCCEyQ0ZICCFEZsgItSJ+++03d8ghh7g333wzGRHNpX///u6xxx5LnonmMrvIT3pSPWSEWhHee/f777+7f/75JxkRzWX69Onu77//Tp6J5jK7yE96Uj1khIQQQmRG1YzQtGnT3NVXX+3OPvtsN3ny5GTUuSeffLLmwt4PP/zQnXHGGfZ5+dxpiEJIh33zzTfJiHPPP/+8GzJkiPv222+TkdqGaOrOO+90J510knvppZcswkozZcoU9/LLL9dHXKQBL774YvfAAw80OrYYOM8TTzxh1xs6dGi97KKcL7rookZyrmWQAXJjPsgReab566+/3Isvvlg/J45HdsgQWZbCJ598YjqWvmdxTTH23nvvJUeKWiELPYHWtt6qYoS++OIL17VrV3fyySebAHbYYQf3yiuv2MIaNmyYW3311ZMjs4fN95hjjnGrrrqqu/76692hhx7aQHm4uVtuuaW78cYb7fl3333n+vbt6y644AJTtFoHxT/ttNNsnvPNN5/bfvvtzRGIMFfmvO+++7qvvvrKxm644QY3ePBge9/3339vY8UydepUd9hhh7l77rnH7bLLLu7nn392Xbp0scVwxBFHuM0339y99tprrq6uzlIgrYH777/fnXvuuW6ttday2sFZZ51lG0gE3ejWrZt75JFH7Plbb71lOoIMn332WRsrFs577bXXuqOOOsqtt956boMNNnB77LGHGzBggNttt93c3HPP7ZZZZhn7//XXX0/e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)

Aqui,
𝑧
z é chamado de logit ou escore linear.
Aplicação da Função Sigmoide:

O valor
𝑧
z é transformado em uma probabilidade com a função sigmoide:![Captura de tela 2025-01-13 212746.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUwAAABSCAYAAAA/xe0AAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAA7uSURBVHhe7Z0JsFVzHMf/Zd8lZFeWkF0Tsu/ZehRGpuxL1tFIKGv2hIixVWOGQY1lrBlbZQtFlBAho5QiWWNCx/n83vnXeffd+97/3rfcxfczc+be+z/nnnPePe9+72/7/06LKMYJIYSol5bJoxBCiHqQYAohRCASTCGECESCKYQQgUgwhRAiEAmmEEIEIsEUQohAJJhCCBGIBFMIIQKRYAohRCASTCGECESCKYQQgUgwhRAiEAmmEEIEIsEUQohAJJhCCBGIBFMIIQKRYAohRCASTCHKFO4u8/rrr7u99trLffzxx8moaEp0Tx8hyogFCxa4MWPGuPHjx7tXX33VzZgxw6200krupZdecjvttFOylWgqZGEKUUb89ttv7r333nOtW7d2N998s1t//fWTNaI5kIUpRJny/fffuwMOOMDNnz9fFmYzIQtTCCECkWAKIUQgEkwhhAhEgimEEIFIMIUQIhAJphBCBCLBFEKIQCSYQggRiARTCCECkWAKIUQgFSWYX3/9tTviiCPc5MmTkxFRynCdunXr5r777rtkRNTHv//+63744QebFknjDeaW//33327OnDk2Nm/ePHstmoaizSXnor799tvu559/Tkays/rqq9sc2bXWWisZyc7MmTPd8ccf7y699FJ31FFHJaNh/Pnnn+6tt95yn3zyiYnu5ptv7nr37u1WXHHFZAvRVDzzzDNu0KBBbtSoUW7jjTdORkUu/PzxWbNmJSM1UeeipqVogvnLL7+4M844w/r48U+wePFit9xyy7k2bdokW1Qzd+5cE9euXbu622+/vdZ6QPBOPvlk165dO+vg0qJFi2RNGPxi9+rVy73//vt2LPoLPv74426VVVZJthCFgPVz9dVXu3/++ccNHTo0Ga0J/36XXXaZmzZtmnv00Uf1mYvSBsEsJgsWLIj22WefaLXVVotGjBiRjC5l4cKF0SWXXGLrq6qqot9//z1Zs5SRI0dGW221VfTVV18lI4Uxfvz4qFWrVtFhhx2W9TiifiZOnBgNGTIkiq39aI011rDrdtZZZyVrs8N14/oNHz48GRGiNCl6DBML8ptvvnHL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)

Exemplo de Função Sigmoide:

Para
𝑧
=
0
z=0: Probabilidade = 0.5.


Para
𝑧
=
2
z=2: Probabilidade = 0.88.

Para
𝑧
=
−
2
z=−2: Probabilidade = 0.12.

O Papel do Threshold (Limiar de Decisão)
O modelo usa um threshold (geralmente 0.5) para converter a probabilidade em uma previsão de classe:

Se
𝑃
(
classe
=
1
)
>
0.5
P(classe=1)>0.5: Previsão = "Em Dia" (1).
Se
𝑃
(
classe
=
1
)
≤
0.5
P(classe=1)≤0.5: Previsão = "Inadimplente" (0).

Ajustando o Threshold:

Aumentar o threshold (e.g., 0.7) reduz os falsos positivos (FP), mas pode aumentar os falsos negativos (FN).


Diminuir o threshold (e.g., 0.3) reduz os falsos negativos, mas aumenta os falsos positivos.

# Lidando com Outiliers, Alta Dimensionalidade e variáveis Altamente Correlacionadas

# Outiliers


Variáveis financeiras (vlr_principal, vlr_multa, vlr_juros, vlr_total) possuem valores máximos que são muito maiores que o percentil 75.
Isso confirma que são right-skewed (assimétricas à direita).
lgumas variáveis, como vlr_total, possuem valores mínimos de 0.
Zeros são válidos, mas podem precisar de um tratamento especial, especialmente na transformação logarítmica

# Transformação Logarítmica para Variáveis Assimétricas

**Como Funciona:**

O logaritmo comprime os valores à medida que eles crescem, reduzindo a diferença entre valores pequenos e grandes.
Adicionamos
+
1
+1 para evitar problemas com
𝑥
=
0
x=0 (pois
log
⁡
(
0
)
log(0) é indefinido)
"""

#Criando as novas colunas transformadas e as adcionando ao DF

df['vlr_principal_log'] = np.log1p(df['vlr_principal'])
df['vlr_multa_log'] = np.log1p(df['vlr_multa'])
df['vlr_juros_log'] = np.log1p(df['vlr_juros'])
df['vlr_total_log'] = np.log1p(df['vlr_total'])

# Antes da transformação
sns.histplot(df['vlr_total'], kde=True, bins=50, color='blue')
plt.title('Antes da Transformação')
plt.show()

# Depois da transformação
sns.histplot(df['vlr_total_log'], kde=True, bins=50, color='blue')
plt.title('Após a Transformação Logarítmica')
plt.show()

"""# Aplicando as colunas transformadas pelo Log"""

#Excluir as colunas originais do DF para usarmos as novas transformadas pelo Log
df = df.drop(columns=['vlr_principal', 'vlr_multa', 'vlr_juros', 'vlr_total'])

#Visualizar o DataFrame atualizado
print(df.head())

"""# PCA
Vimos que as variaveis vlr_principal, vlr_juros, e vlr_total são altamente correlacionadas, ao usar um modelo como o DBSCAN pode criar redundância desnecessária. Usando a PCA podemos combinar essas variaveis em 1 ou 2 componentes principais, que são as combinações lineares das variáveis originais:


![Captura de tela 2025-01-16 203418.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAW0AAABwCAYAAADVPiHTAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAACBPSURBVHhe7Z0JvFXTHsdXpmcMoegpopDUo5QkHh4l0aAM9UqJNMlQPJkiqo+MqQwlz1SRMn14iXTNiWQMCSFDRBJl1nrr+79r3fY595xzz526Z9/7/34++3PPWXvvdfZee63/+q/f+q99q1mHURRFUWLBRv6voiiKEgPUaCuKosQINdqKoigxQo22oihKjFCjrSiKEiPUaCuKosQINdqKoigxQo22oihKjFCjrSiKEiPUaCuKosQINdqKoigxQo22oihKjFCjrSiKEiPUaCuKosQINdqKoigxQo22oihKjFCjrSiKEiPUaCuKosQINdqKoigxQo22oihKjKiQf+z7yy+/mBdffNGsXbvWp6SmevXqZv/99zc1atTwKZn566+/zGuvvWZuu+0289xzz5lff/3V7LLLLqZLly6mf//+ks/nn39ubrjhBjNq1Ciz5ZZb+jMVRVHiQYUY7W+//db06NHDfPbZZ+brr78269atk/Sdd97ZbLLJJvIZ1qxZY3744QfTvHlzM3HiRFO/fn2/pzCLFy8Ww/z666+bpk2bmnPOOce0aNFC8n7wwQfNlClTzPDhw83kyZPNn3/+aWbMmGG22morf/Z6fvrpJ3P55ZfLMePGjfOpiqIoOQJGuyJxXq/dZpttbJs2bawzmD41H2dw7cyZM+22225rd911V+u8aL8nkby8PNlfs2ZN+7///U/OS8YZddu4cWP5rXbt2lnXIfg91i5YsMDeeOON9uSTT5bf4pgzzzzT71UURckdckbT3njjjU21atX8t3z4fsIJJ5hu3bqZ1atXmwsuuMD8+OOPfm8+b731ljn11FMl/ZZbbjHHHntsoXxg7733NiNHjky577333jPLli0znTt3NmeddZZPVSqad955x5x22mnm559/9ilKJoYMGWLmzJnjvymVlZyfiMTI7rXXXvL5zTffNO+++658BrRxtGkM+pFHHikGOxP/+te/zCGHHOK/rQejj87tPG2zww47+FSlomGOgnkJ51z4FCUTzBEh6ymVm1hFj1Ah0bgDeGJ5eXnyGW98iy22kM/pQMPGuCuKosSVWBjtr776Sv5u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)


a
i
​
 ,b
i
​
 : coeficientes que determinam a contribuição de cada variável para o componente.

A PCA combina as variáveis em 1 ou 2 componentes principais, reduzindo a colinearidade entre elas. Isso elimina a inflação nas distâncias artificiais entre os pontos e minimiza redundâncias, ao mesmo tempo preservando a maior parte da informação presente nos dados.
Em cenários de alta dimensionalidade onde há muitas variáveis em relação ao número de observações, as distâncias entre os pontos podem se tornar maiores (não necessariamente correlacionadas).

Nesses casos a PCA trabalha para reduzir a dimensionalidade, simplificando os dados em componentes principais que ocupam espaços menores e mais representativos


"""

# Verificar os tipos de dados no DataFrame
print(df.info())

# Verificar as primeiras linhas de cada coluna para identificar valores categóricos ou não numéricos
print(df.head())

# Selecionar somente colunas relevantes para a PCA, excluindo variaveis temporais, identificador numérico...
columns_for_pca = [
    'qtde_entes',
    #'score',
    'percentual_multa',
    'percentual_juros',
    'percentual_principal',
    'vlr_principal_log',
    'vlr_multa_log',
    'vlr_juros_log',
    'vlr_total_log'
]

# Criar DF apenas com essas colunas
df_pca = df[columns_for_pca]

#Substituindo valores ausentes por média
df_pca.fillna(df_pca.mean(), inplace=True)

#Padronizar as colunas com Standard
scaler = StandardScaler()
df_scaled = scaler.fit_transform(df_pca)

#Aplicar a PCA com todas as componentes
pca = PCA(n_components=len(df_pca.columns))
pca_result = pca.fit_transform(df_scaled)

"""# Variância na PCA

Na PCA , a variância é usada para determinar quais componentes carregam mais informações:



1.   Cada componente principal explica uma porção da variância total nos dados.
2.   A variância explicada ajuda a decidir quantos componentes devem ser mantidos para capturar a maior parte da informação.


"""

# Visualizar a variância explicada
print("Variância explicada por cada componente:")
print(pca.explained_variance_ratio_)

print("Variância explicada acumulada:")
print(pca.explained_variance_ratio_.cumsum())

plt.figure(figsize=(8, 5))
plt.plot(range(1, len(df_pca.columns) + 1), pca.explained_variance_ratio_.cumsum(), marker='o', linestyle='--')
plt.xlabel('Número de Componentes')
plt.ylabel('Variância Explicada Acumulada')
plt.title('PCA - Variância Explicada')
plt.grid()
plt.show()

"""# Método do Cotovelo

O método do cotovelo identifica o ponto onde a curva começa a se achatar (o "cotovelo"), indicando que componentes adicionais explicam apenas alguns incrementos mínimos da variância e não são tão significativos assim.

**Ponto antes do achatamento:** Este é o número ideal de componentes principais porque inclui a maior parte da informação relevante, sem incluir componentes redundantes ou desnecessários

**Com base na análise vamos reduzir o número de componentes para 4.**
"""

#Ajustando a PCA para 4 componentes
pca = PCA(n_components=4)
pca_result = pca.fit_transform(df_scaled)

#Verificar o formato
print(pca_result.shape)

"""# Combinar a PCA + Variáveis adicionais"""

#Selecionar as variáveis adicionais
variables_to_include = ['score', 'situacao_debito_bin']

#Padronizar as variáveis adicionais
scaler_additional = StandardScaler()
variables_scaled = scaler_additional.fit_transform(df[variables_to_include])

# Combinar os componentes principais da PCA com as variáveis adicionais
X_combinacao = np.hstack([pca_result, variables_scaled])

"""# Aplicando o DBSCAN"""

#Aplicar o DBSCAN
dbscan = DBSCAN(eps=0.5, min_samples=5)
clusters = dbscan.fit_predict(X_combinacao)

# Adicionar os clusters ao DF
df['cluster'] = clusters

# contagem de clusters
print(df['cluster'].value_counts())

display(df)

from mpl_toolkits.mplot3d import Axes3D

fig = plt.figure(figsize=(8, 6))
ax = fig.add_subplot(111, projection='3d')
sc = ax.scatter(pca_result[:, 0], pca_result[:, 1], pca_result[:, 2], c=clusters, cmap='viridis', alpha=0.7)
ax.set_title("Clusters Identificados pelo DBSCAN")
ax.set_xlabel("PC1")
ax.set_ylabel("PC2")
ax.set_zlabel("PC3")
plt.colorbar(sc, label="Cluster")
plt.show()

"""# Análise de total de clientes por Cluster e Score"""

query = """
  SELECT
    cluster,
    COUNT(*) AS total_clientes,
    score,
    AVG(score) AS media_score,
    AVG(vlr_total_log) AS media_vlr_total_log,
    AVG(percentual_multa) AS media_percentual_multa,
    AVG(percentual_principal) AS media_percentual_principal
  FROM df
  GROUP BY cluster,score
  ORDER BY total_clientes DESC
"""
result = duckdb.query(query).to_df()
display(result)

query = """
  SELECT
    cluster,
    COUNT(*) AS total_registros
  FROM df
  GROUP BY cluster
  ORDER BY total_registros DESC
"""
result = duckdb.query(query).to_df()
display(result)

"""# Clusters de maior Score

**Valores altos e consistentes:** Os scores estão acima de 896, com a maioria acima de 970 nos clusters 2,3 e 4. Isso reforça que esses clientes estão com  um comportamento confiável


Embora a maioria dos clientes seja rotulada como "DEVEDOR", **os % de multa são 0** Isso pode significar que os débitos estão sendo gerenciados de forma consistente por parte dos clientes devedores, mas ainda precisam de regularização.

**% de Juros:** Valores médios estão em torno de 0.7, indicando que juros representam uma parte significativa dos débitos totais.

**% Principal:** Com valores próximos de 0.3, o valor principal da dívida é proporcionalmente menor, o que pode refletir em uma boa capacidade de pagamento.

Algumas entradas possuem situação como "SUSP_PROC_JUD", o que pode indicar processos judiciais em andamento para resolver os débitos. Esses clientes podem estar regularizando suas pendências.


"""

query = """
  SELECT *
  FROM df
  WHERE cluster = 2 OR cluster = 3 OR cluster = 4
"""
result = duckdb.query(query).to_df()
display(result)

"""# Oportunidades:

Clientes nesse grupo podem estar próximos de regularizar seus débitos, podem estra tentando regularizar pagando suas parcelas mesmo que ainda não tenha conseguido quitar o valor total da dívida.

 Estratégias para finalização como renegociações ou incentivos de regularização, podem ser eficazes nesse grupo.

Clientes com status "SUSP_PROC_JUD" podem demandar atenção especial para ajudar na conclusão dos processos judiciais.

# Cluster de Menor Score

**% de Multa:**

O percentual de multa varia amplamente indicando que alguns clientes possuem multas altas enquanto outros têm valores baixos, estes estão em maioria nos clusters 0 e 1 (também presentes em outros considerados outiliers)
Um % de multa elevado pode indicar dívidas penalizadas por atrasos prolongados.

**%  Principal:**

Clientes com valores expressivos no percentual principal indicam que o valor principal da dívida constitui a maior parte do total.

Clientes com percentual_principal 0.0 provavelmente têm maior dificuldade em pagar a dívida principal, já que a maior parte do débito está composta de multas e juros.

**Score Baixo e Percentual de Multa Alto:**

Clientes com scores muito baixos (próximos a 0) e percentual_multa elevado podem ser tratados com estratégias de renegociação ou desconto de multas para incentivar o pagamento.

**Score Médio e % Principal elevado:**

Clientes com scores mais altos (próximos a 99) e percentual_principal maior que 0.7 podem ser bons candidatos para programas de fidelização, já que possuem menor risco.
"""

query = """
  SELECT *
  FROM df
  WHERE cluster = 0 OR cluster = 1
"""
result = duckdb.query(query).to_df()
display(result)

"""# Análise Perfil Não Inadimplente

**Clusters Representados:**

Há registros em vários clusters, incluindo 1 (score alto) e 155 (score baixo).
Isso sugere que, mesmo entre clientes não inadimplentes há diferenças significativas de comportamento que refletem em variabilidade nos scores.

**Log de Valores (Multa, Juros e Total):**

Alguns clientes possuem vlr_multa_log e vlr_juros_log iguais a 0, indicando que não há multas ou juros aplicados.


**% de Multa e Principal:**

Clientes com percentual_multa próximo de 0.0 são aqueles que pagam principalmente o valor principal.

Outros clientes com percentual_multa elevado (ex.: 0.78) podem estar pagando mais multas atreladas à dívida do que o valor principal dela.

**Clientes com Baixo Score:**

Possivelmente regularizaram suas dívidas mas com multas altas e valores principais reduzidos para que ficassem mais acessiveis ao pagamento através da redução de taxas e descontos.

**Estratégia:**
Oferecer renegociações para reduzir o percentual de multas e incentivar o pagamento de novos débitos.

**Clientes com Alto Score**

São clientes consistentes e prioritários para fidelização.

**Estratégia:**
Manter condições favoráveis e acompanhar pagamentos futuros e renda para evitar inadimplência.


**Clusters Diferentes Dentro de "PARCELADO":**

A presença de diversos clusters indica perfis distintos de clientes não inadimplentes que podem ser explorados em detalhes.

Exemplo:

Cluster 155: Clientes com score baixo e percentual de multa elevado.

Cluster 1: Clientes com score alto e valores de dívida elevados.
"""

query = """
  SELECT
    mes_referencia,
    tipo_ente,
    cnpj_ente_principal,
    uf_ente_principal,
    tipo_vinculo,
    situacao_debito_bin,
    score,
    cluster,
    vlr_total_log,
    vlr_multa_log,
  	vlr_juros_log,
    percentual_multa,
    percentual_principal
  FROM df
  WHERE  situacao_debito_bin = '1'
  GROUP BY ALL
  ORDER BY score ASC
"""
result = duckdb.query(query).to_df()
display(result)

query = """
  SELECT
    cluster,
    COUNT(*) AS total_clientes,
    score,
    AVG(score) AS media_score,
    AVG(vlr_total_log) AS media_vlr_total_log,
    AVG(percentual_multa) AS media_percentual_multa,
    AVG(percentual_principal) AS media_percentual_principal
  FROM df
  WHERE situacao_debito_bin = '1'
  GROUP BY cluster,score
  ORDER BY total_clientes DESC
"""
result = duckdb.query(query).to_df()
display(result)

"""# **Conclusões Gerais**

# **Perfil Inadimplente**


**Clientes com Score Baixo:**

**Perfil Geral:**

Estão regularizando débitos, mas apresentam percentual de multa elevado (ex: acima de 0.75).
O percentual principal é baixo ou inexistente (0.0), podendo sugerir que a maior parte dos valores pagos corresponde a penalidades e juros acumulados da dívida original.

**Possíveis Razões:**

Dívidas acumuladas por períodos prolongados antes de parcelar.
Multas e juros representam uma barreira significativa para quitação total.

**Recomendações Estratégicas:**

Oferecer descontos ou renegociações focadas em reduzir as multas e juros, incentivando o pagamento do principal.
Acompanhar de perto esses clientes para prevenir retornos à inadimplência.

**Clientes com Score Alto**

**Perfil Geral:**

Apresentam regularidade nos pagamentos, com percentual principal elevado (ex: acima de 0.48) e percentual de multa reduzido (ex: 0).
Predominam no cluster 1, representando clientes de menor risco financeiro.
Alguns possuem dívidas totais elevadas, mas com pagamentos consistentes, como indicado pelos valores logarítmicos altos (vlr_total_log > 21).
Possíveis Razões:

Histórico de bom comportamento financeiro, com adesão a parcelamentos e quitação do principal.
Beneficiários de programas de renegociação ou acordos recentes.
Recomendações Estratégicas:

Manter condições favoráveis para fidelizar esses clientes, garantindo que continuem regularizados.
Explorar oportunidades de programas de fidelidade ou benefícios para incentivar novos parcelamentos.


# **Perfil Parcelado**

**Clientes com Baixo Score:**

Estão regularizando suas dívidas mas com multas altas e valores principais reduzidos para que ficassem mais acessiveis ao pagamento através da redução de taxas e descontos e assim o cliente tendo a oportunidade de quitar

**Estratégia:**
Oferecer renegociações para reduzir o percentual de multas e incentivar o pagamento de novos débitos (podendo ser à vista e com maiores descontos)

**Clientes com Alto Score**

São clientes consistentes e prioritários para fidelização, além de possuirem um bom Score, estão regularizando suas dívidas.

**Estratégia:**
Manter condições favoráveis e acompanhar pagamentos futuros e renda para evitar inadimplência.
"""